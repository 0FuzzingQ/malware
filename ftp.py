#coding=utf-8
from ftplib import FTP
import sys
import getopt


arg_dict = {}
pwd_list = []
def getarg(argv):
	try:
		options,args = getopt.getopt(argv,"hi:p:d:",["help","ip=","port=","dict="])
	except getopt.GetoptError:
		sys.exit()

	for option,value in options:
		if option in ("-h","--help"):
			print "[*]Usage:python ftp.py [-i||--ip] hostip [-p||--port] ftpport [-d||--dict] pwdtxt"
		if option in ("-i","--ip"):
			arg_dict["ip"] = format(value)
		if option in ("-p","--port"):
			arg_dict["port"] = format(value)
		if option in ("-d","--dict"):
			arg_dict["dict"] = format(value)
	#print arg_dict

def login(ip,port,pwd):
	try:
		ftp = FTP()
		ftp.connect(ip,port)
		ftp.login('anonymous','test@test.com')
		print "[*]anonymous login success with username anonymous"
		ftp.quit()
	except Exception,e:
		print "[*]can not login as anonymous"
	for kp in pwd:
		user = pwd.split(",")[0]
		pw = pwd.split(",")[1]
		ftp = FTP()
		try:
			ftp.connect(ip,port)
			ftp.login(user,pw)
			if ftp.getwelcome() :
				print "[*]lOGIN SUCCESS with username:" + user + "password:" + pw
				ftp.quit()
				break
		except:
			print "[*]can not connect to ftp server"
			exit() 


if __name__ == '__main__':
	getarg(sys.argv[1:])
	ip = arg_dict["ip"]
	port = arg_dict["port"]
	f = open(arg_dict["dict"],"r")
	try:
		while True:
			line = f.readline().strip("\r")
			pwd_list.append(line)
	finally:
		f.close()
	login(ip,port,pwd_list)
